"use strict";(self.webpackChunktibillet=self.webpackChunktibillet||[]).push([[8139],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var u=a.createContext({}),o=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=o(e.components);return a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,u=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=o(n),m=l,g=c["".concat(u,".").concat(m)]||c[m]||d[m]||r;return n?a.createElement(g,i(i({ref:t},p),{},{components:n})):a.createElement(g,i({ref:t},p))}));function m(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,i=new Array(r);i[0]=c;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:l,i[1]=s;for(var o=2;o<r;o++)i[o]=n[o];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},5496:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>o});var a=n(7462),l=(n(7294),n(3905));const r={sidebar_position:3,slug:"tenants",title:"Tenants",description:"Cr\xe9ez et listez les instances de votre serveur multi-tenant",keywords:["cashless","billetterie","ticketing","cli","curl","python","tenant","saas"],wiktags:["cashless","billetterie","ticketing","curl","python","tenant","saas"],authors:"jonas"},i=void 0,s={unversionedId:"api/03 Tenants",id:"api/03 Tenants",title:"Tenants",description:"Cr\xe9ez et listez les instances de votre serveur multi-tenant",source:"@site/docs/api/03 Tenants.md",sourceDirName:"api",slug:"/api/tenants",permalink:"/docs/api/tenants",draft:!1,editUrl:"https://github.com/TiBillet/documentation/tree/main/tibillet/docs/api/03 Tenants.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,slug:"tenants",title:"Tenants",description:"Cr\xe9ez et listez les instances de votre serveur multi-tenant",keywords:["cashless","billetterie","ticketing","cli","curl","python","tenant","saas"],wiktags:["cashless","billetterie","ticketing","curl","python","tenant","saas"],authors:"jonas"},sidebar:"api",previous:{title:"API Keys",permalink:"/docs/api/apikey"},next:{title:"Produits",permalink:"/docs/api/products"}},u={},o=[{value:"Base de donn\xe9es partag\xe9e, sch\xe9mas distincts.",id:"base-de-donn\xe9es-partag\xe9e-sch\xe9mas-distincts",level:2},{value:"Cat\xe9gories",id:"cat\xe9gories",level:2},{value:"Lieu",id:"lieu",level:3},{value:"Festival",id:"festival",level:3},{value:"Projet",id:"projet",level:3},{value:"Producteurs",id:"producteurs",level:3},{value:"Meta : L&#39;agenda f\xe9d\xe9r\xe9",id:"meta--lagenda-f\xe9d\xe9r\xe9",level:3},{value:"Root",id:"root",level:3},{value:"Donn\xe9es initiales",id:"donn\xe9es-initiales",level:2},{value:"Lister les tenants",id:"lister-les-tenants",level:2},{value:"Cr\xe9ation de nouveau tenant",id:"cr\xe9ation-de-nouveau-tenant",level:2},{value:"example",id:"example",level:2}],p={toc:o};function d(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"base-de-donn\xe9es-partag\xe9e-sch\xe9mas-distincts"},"Base de donn\xe9es partag\xe9e, sch\xe9mas distincts."),(0,l.kt)("p",null,"TiBillet est construit autour d'une architecture multi-tenant. Il s'agit d'une fonctionnalit\xe9 essentielle pour toute\napplication de type \"Software-as-a-Service\"."),(0,l.kt)("p",null,"C'est une approche semi-isol\xe9e : Base de donn\xe9es partag\xe9e, sch\xe9mas distincts. Une base de donn\xe9es pour tous les\nlocataires, mais un sch\xe9ma par locataire."),(0,l.kt)("p",null,"Pour plus d'information : ",(0,l.kt)("a",{parentName:"p",href:"https://django-tenants.readthedocs.io/"},"https://django-tenants.readthedocs.io/")),(0,l.kt)("h2",{id:"cat\xe9gories"},"Cat\xe9gories"),(0,l.kt)("p",null,"Nous avons d\xe9fini plusieurs cat\xe9gories de tenant qui determinent les comportements et templates."),(0,l.kt)("h3",{id:"lieu"},"Lieu"),(0,l.kt)("p",null,"Une salle de spectacle, un caf\xe9 concert, un tiers lieux..."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Un nom."),(0,l.kt)("li",{parentName:"ul"},"Un lieu."),(0,l.kt)("li",{parentName:"ul"},"Une sc\xe8ne."),(0,l.kt)("li",{parentName:"ul"},"Un ou plusieurs artistes par soir.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'categorie = "S"\n')),(0,l.kt)("h3",{id:"festival"},"Festival"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Un nom."),(0,l.kt)("li",{parentName:"ul"},"Un ou plusieurs lieux."),(0,l.kt)("li",{parentName:"ul"},"Une ou plusieurs sc\xe8nes."),(0,l.kt)("li",{parentName:"ul"},"Un ou plusieurs artistes par soir.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'categorie = "F"\n')),(0,l.kt)("h3",{id:"projet"},"Projet"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Un nom."),(0,l.kt)("li",{parentName:"ul"},"Plusieurs lieux et sc\xe8nes sur plusieurs dates.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'categorie = "A"\n')),(0,l.kt)("h3",{id:"producteurs"},"Producteurs"),(0,l.kt)("p",null,"Ex : Boite de production, agent, compagnie de th\xe9atre, tourneur"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Plusieurs projets."),(0,l.kt)("li",{parentName:"ul"},"Plusieurs lieux et sc\xe8nes.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'categorie = "P"\n')),(0,l.kt)("h3",{id:"meta--lagenda-f\xe9d\xe9r\xe9"},"Meta : L'agenda f\xe9d\xe9r\xe9"),(0,l.kt)("p",null,"Plusieurs instances se f\xe9d\xe8rent pour cr\xe9er un agenda \xe9v\xe8nementiel commun."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Plusieurs lieux"),(0,l.kt)("li",{parentName:"ul"},"Plusieurs projets")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'categorie = "M"\n')),(0,l.kt)("h3",{id:"root"},"Root"),(0,l.kt)("p",null,"Une seule instance par serveur.\nG\xe8re les tables communes \xe0 tous les tenants :"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Cartes NFC"),(0,l.kt)("li",{parentName:"ul"},"Utilisateurs"),(0,l.kt)("li",{parentName:"ul"},"Super-users"),(0,l.kt)("li",{parentName:"ul"},"Gestion des domaines principaux et sous domaines multi tenant.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'categorie = "R"\n')),(0,l.kt)("h2",{id:"donn\xe9es-initiales"},"Donn\xe9es initiales"),(0,l.kt)("p",null,"Lors de l'installation d'un nouveau serveur Django, une instance ROOT et une META sont d\xe9ja pr\xe9sente."),(0,l.kt)("p",null,"S'il ne peut y avoir qu'un seul ROOT, plusieurs instances META sont possibles pour un agenda f\xe9d\xe9r\xe9 autour d'une\ncommunaut\xe9 interne."),(0,l.kt)("p",null,"La premi\xe8re META initalement cr\xe9\xe9e est utile pour lister toutes les autres instances du serveur Django. Le sous domaine\npar defauilt est \"meta\". Il est possible de changer l'adresse avant l'installation : modifiez le fichier .env pr\xe9sent \xe0\nla racine du docker-compose. Il est aussi possible de changer l'adresse post install dans l'administration ROOT."),(0,l.kt)("h2",{id:"lister-les-tenants"},"Lister les tenants"),(0,l.kt)("p",null,"\xc0 lancer sur la premi\xe8re META."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"# all tenant :\nGET https://meta.tibillet.local/api/place/\n\n# retrieve one tenant :\nGET https://meta.tibillet.local/api/place/<uuid>\n")),(0,l.kt)("h2",{id:"cr\xe9ation-de-nouveau-tenant"},"Cr\xe9ation de nouveau tenant"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"POST /api/prices/\n")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Item"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"Requis"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"organisation"),(0,l.kt)("td",{parentName:"tr",align:null},"text"),(0,l.kt)("td",{parentName:"tr",align:null},"Y")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"short_description"),(0,l.kt)("td",{parentName:"tr",align:null},"text"),(0,l.kt)("td",{parentName:"tr",align:null},"Y")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"long_description"),(0,l.kt)("td",{parentName:"tr",align:null},"decimal"),(0,l.kt)("td",{parentName:"tr",align:null},"Y")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"phone"),(0,l.kt)("td",{parentName:"tr",align:null},"int"),(0,l.kt)("td",{parentName:"tr",align:null},"Y")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"email"),(0,l.kt)("td",{parentName:"tr",align:null},"email"),(0,l.kt)("td",{parentName:"tr",align:null},"Y")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"site_web"),(0,l.kt)("td",{parentName:"tr",align:null},"url"),(0,l.kt)("td",{parentName:"tr",align:null},"Y")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"postal_code"),(0,l.kt)("td",{parentName:"tr",align:null},"text"),(0,l.kt)("td",{parentName:"tr",align:null},"Y")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"img_url"),(0,l.kt)("td",{parentName:"tr",align:null},"url"),(0,l.kt)("td",{parentName:"tr",align:null},"Y")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"logo_url"),(0,l.kt)("td",{parentName:"tr",align:null},"url"),(0,l.kt)("td",{parentName:"tr",align:null},"Y")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"categorie"),(0,l.kt)("td",{parentName:"tr",align:null},"text"),(0,l.kt)("td",{parentName:"tr",align:null},"Y")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"adress"),(0,l.kt)("td",{parentName:"tr",align:null},"text"),(0,l.kt)("td",{parentName:"tr",align:null},"N")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"city"),(0,l.kt)("td",{parentName:"tr",align:null},"text"),(0,l.kt)("td",{parentName:"tr",align:null},"N")))),(0,l.kt)("h2",{id:"example"},"example"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'import requests\n\nurl = "http://meta.tibillet.local/api/place/"\n\npayload = {\n    "organisation": "Le Bisik",\n    "short_description": " Le lieu des musiques actuelles de Saint-Beno\xeet",\n    "long_description": "ACTER (Agir pour la Culture et le Tourisme dans l\u2019Est de La R\xe9union) est n\xe9e il y cinq ans de la volont\xe9 farouche de porter un projet culturel populaire et de cr\xe9er un lieu de diffusion original de Musiques Actuelles dans l\u2019Est de La R\xe9union. Avec le Bisik nous avons invent\xe9 un tiers-lieu original, un espace de convivialit\xe9 pluriel qui pourrait pr\xe9figurer une Sc\xe8ne De Musiques Actuelles adapt\xe9e au territoire souhait\xe9e par notre \xe9quipe et d\u2019ores et d\xe9j\xe0 par nombre de nos partenaires avec qui nous signerons prochainement un conventionnement pluriannuel.",\n    "phone": "0692929292",\n    "email": "contact+bisik@tibillet.re",\n    "site_web": "http://bisik.re",\n    "postal_code": "97410",\n    "img_url": "http://bisik.re/wp-content/uploads/2019/01/MayaBisik.jpg",\n    "logo_url": "http://bisik.re/wp-content/uploads/2017/05/logo-Bisik.png",\n    "categorie": "S"\n}\nheaders = {\n    "Content-Type": "application/json",\n    "Authorization": "Api-Key  NvGv0CHV.aQGS09HOQuF14sqfez8132jhEd8UAcBsp"\n}\n\nresponse = requests.request("POST", url, json=payload, headers=headers)\n\nprint(response.text)\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="HTTP json response"',title:'"HTTP',json:!0,'response"':!0},'{\n    "uuid": "1cf9889c-3414-4a39-bdde-1a36e1f97b96",\n    "organisation": "Le Bisik",\n    "slug": "le-bisik",\n    "short_description": "Le lieu des musiques actuelles de Saint-Beno\xeet",\n    "long_description": "ACTER (Agir pour la Culture et le Tourisme dans l\u2019Est de La R\xe9union) est n\xe9e il y cinq ans de la volont\xe9 farouche de porter un projet culturel populaire et de cr\xe9er un lieu de diffusion original de Musiques Actuelles dans l\u2019Est de La R\xe9union. Avec le Bisik nous avons invent\xe9 un tiers-lieu original, un espace de convivialit\xe9 pluriel qui pourrait pr\xe9figurer une Sc\xe8ne De Musiques Actuelles adapt\xe9e au territoire souhait\xe9e par notre \xe9quipe et d\u2019ores et d\xe9j\xe0 par nombre de nos partenaires avec qui nous signerons prochainement un conventionnement pluriannuel.",\n    "adress": null,\n    "postal_code": 97410,\n    "city": null,\n    "phone": "0692929292",\n    "email": "contact@tibillet.re",\n    "site_web": "http://bisik.re",\n    "legal_documents": null,\n    "twitter": null,\n    "facebook": null,\n    "instagram": null,\n    "adhesion_obligatoire": false,\n    "button_adhesion": false,\n    "map_img": null,\n    "carte_restaurant": null,\n    "img_variations": {\n        "fhd": "/media/images/MayaBisik_shOX4fO.fhd.jpg",\n        "hdr": "/media/images/MayaBisik_shOX4fO.hdr.jpg",\n        "med": "/media/images/MayaBisik_shOX4fO.med.jpg",\n        "thumbnail": "/media/images/MayaBisik_shOX4fO.thumbnail.jpg"\n    },\n    "logo_variations": {\n        "fhd": "/media/images/MayaBisik_shOX4fO.fhd.jpg",\n        "hdr": "/media/images/MayaBisik_shOX4fO.hdr.jpg",\n        "med": "/media/images/MayaBisik_shOX4fO.med.jpg",\n        "thumbnail": "/media/images/MayaBisik_shOX4fO.thumbnail.jpg"\n    },\n    "categorie": "S"\n}\n')))}d.isMDXComponent=!0}}]);