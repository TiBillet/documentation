"use strict";(self.webpackChunktibillet=self.webpackChunktibillet||[]).push([[7300],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>b});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(r),b=o,m=d["".concat(s,".").concat(b)]||d[b]||c[b]||i;return r?n.createElement(m,a(a({ref:t},u),{},{components:r})):n.createElement(m,a({ref:t},u))}));function b(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=r.length,a=new Array(i);a[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var p=2;p<i;p++)a[p]=r[p];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},698:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var n=r(7462),o=(r(7294),r(3905));const i={sidebar_position:40,slug:"webhook",title:"Webhook",description:"Envoyer un POST pour chaque reservation valid\xe9e.",keywords:["ticketing","billetterie","webhook","api"],wiktags:["ticketing","billetterie","webhook","api"],authors:"Jonas"},a=void 0,l={unversionedId:"Utilisateur/Billetterie/40 webhook",id:"Utilisateur/Billetterie/40 webhook",title:"Webhook",description:"Envoyer un POST pour chaque reservation valid\xe9e.",source:"@site/docs/Utilisateur/Billetterie/40 webhook.md",sourceDirName:"Utilisateur/Billetterie",slug:"/Utilisateur/Billetterie/webhook",permalink:"/docs/Utilisateur/Billetterie/webhook",draft:!1,editUrl:"https://github.com/TiBillet/documentation/tree/main/tibillet/docs/Utilisateur/Billetterie/40 webhook.md",tags:[],version:"current",sidebarPosition:40,frontMatter:{sidebar_position:40,slug:"webhook",title:"Webhook",description:"Envoyer un POST pour chaque reservation valid\xe9e.",keywords:["ticketing","billetterie","webhook","api"],wiktags:["ticketing","billetterie","webhook","api"],authors:"Jonas"},sidebar:"tutorialSidebar",previous:{title:"Billetterie",permalink:"/docs/category/billetterie"},next:{title:"Syndication par flux RSS",permalink:"/docs/Utilisateur/Billetterie/rss"}},s={},p=[],u={toc:p};function c(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Il est possible de r\xe9aliser des webhook apr\xe8s chaque \xe9v\xe8nement r\xe9alis\xe9 sur la billetterie dans l'interface\nd'administration."),(0,o.kt)("p",null,"exemple : ",(0,o.kt)("a",{parentName:"p",href:"https://demo.betabillet.tech/adminBaseBillet/webhook/"},"https://demo.betabillet.tech/adminBaseBillet/webhook/")),(0,o.kt)("p",null,"Le webhook se d\xe9clenche \xe0 chaque validation de reservation gratuite ou payante, en m\xeame temps que l'envoi des billets\npar email."),(0,o.kt)("p",null,'Il est possible de voir la derni\xe8re r\xe9ponse de la requete dans le champ "Last response".'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="Reservation"',title:'"Reservation"'},'# Celery task : Billetterie/DjangoFiles/BaseBillet/tasks.py\n\nreservation = Reservation.objects.get(pk=reservation_pk)\njson = {\n    "object": "reservation",\n    "uuid": f"{reservation.uuid}",\n    "state": f"{reservation.status}",\n    "datetime": f"{reservation.datetime}",\n}\n\nfor webhook in webhooks:\n    try :\n        response = requests.request("POST", webhook.url, data=json, timeout=2)\n        webhook.last_response = f"{timezone.now()} - status code {response.status_code} - {response.text}"\n    except Exception as e :\n        logger.error(f"webhook_reservation ERROR : {reservation_pk} {timezone.now()} {e}")\n        webhook.last_response = f"{timezone.now()} - {e}"\n    webhook.save()\n\n')),(0,o.kt)("p",null,"Il est ensuite possible de r\xe9cup\xe9rer plus d'information sur la reservation via l'API standard ",(0,o.kt)("a",{parentName:"p",href:"/docs/api/reservations"},"/docs/api/reservations")))}c.isMDXComponent=!0}}]);